<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Gestion des Candidatures - Pet's Heaven Admin</title>
  
  <!-- Bootstrap 5 -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet">
  
  <style>
    :root {
      --primary: #6366f1;
      --secondary: #8b5cf6;
      --accent: #ec4899;
      --success: #10b981;
      --danger: #ef4444;
      --warning: #f59e0b;
      --light-bg: #f8fafc;
      --dark-text: #0f172a;
      --gradient-1: linear-gradient(135deg, #6366f1 0%, #8b5cf6 50%, #ec4899 100%);
      --shadow-md: 0 10px 30px rgba(99, 102, 241, 0.15);
      --shadow-lg: 0 20px 60px rgba(99, 102, 241, 0.2);
    }

    body {
      background: linear-gradient(180deg, #f8fafc 0%, #f0f9ff 50%, #faf5ff 100%);
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      min-height: 100vh;
    }

    /* === HEADER === */
    .admin-header {
      background: white;
      border-bottom: 2px solid rgba(99, 102, 241, 0.1);
      padding: 1.5rem 0;
      box-shadow: var(--shadow-md);
      position: sticky;
      top: 0;
      z-index: 100;
    }

    .admin-title {
      font-size: 2rem;
      font-weight: 900;
      background: var(--gradient-1);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      margin: 0;
      letter-spacing: -1px;
    }

    /* === SIDEBAR STATS === */
    .stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 1.5rem;
      margin-bottom: 2rem;
    }

    .stat-box {
      background: white;
      border-radius: 14px;
      padding: 1.5rem;
      box-shadow: var(--shadow-md);
      border-left: 4px solid var(--primary);
      transition: all 0.3s ease;
    }

    .stat-box:hover {
      transform: translateY(-4px);
      box-shadow: var(--shadow-lg);
    }

    .stat-box.pending { border-left-color: var(--warning); }
    .stat-box.interview { border-left-color: var(--secondary); }
    .stat-box.approved { border-left-color: var(--success); }
    .stat-box.rejected { border-left-color: var(--danger); }

    .stat-number {
      font-size: 2.5rem;
      font-weight: 900;
      background: var(--gradient-1);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      margin-bottom: 0.5rem;
    }

    .stat-label {
      font-size: 0.9rem;
      color: #64748b;
      font-weight: 700;
      text-transform: uppercase;
    }

    /* === CANDIDATES TABLE === */
    .candidates-container {
      background: white;
      border-radius: 16px;
      box-shadow: var(--shadow-md);
      padding: 2rem;
      margin-bottom: 2rem;
      border: 1px solid rgba(99, 102, 241, 0.05);
    }

    .section-title {
      font-size: 1.5rem;
      font-weight: 800;
      color: var(--dark-text);
      margin-bottom: 1.5rem;
      display: flex;
      align-items: center;
      gap: 0.75rem;
      letter-spacing: -0.5px;
    }

    .section-title i {
      background: var(--gradient-1);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      font-size: 1.8rem;
    }

    .candidates-table {
      overflow-x: auto;
    }

    table {
      width: 100%;
      border-collapse: collapse;
    }

    thead {
      background: rgba(99, 102, 241, 0.05);
      border-bottom: 2px solid rgba(99, 102, 241, 0.1);
    }

    th {
      padding: 1.2rem;
      font-weight: 800;
      color: var(--dark-text);
      text-transform: uppercase;
      font-size: 0.85rem;
      letter-spacing: 0.5px;
      text-align: left;
    }

    td {
      padding: 1.2rem;
      border-bottom: 1px solid rgba(99, 102, 241, 0.08);
      color: #64748b;
    }

    tbody tr {
      transition: all 0.3s ease;
    }

    tbody tr:hover {
      background: rgba(99, 102, 241, 0.05);
      transform: translateX(4px);
    }

    .badge-status {
      display: inline-block;
      padding: 0.5rem 1rem;
      border-radius: 8px;
      font-weight: 700;
      font-size: 0.85rem;
    }

    .badge-pending { background: rgba(245, 158, 11, 0.2); color: #92400e; }
    .badge-interview { background: rgba(139, 92, 246, 0.2); color: #5b21b6; }
    .badge-approved { background: rgba(16, 185, 129, 0.2); color: #065f46; }
    .badge-rejected { background: rgba(239, 68, 68, 0.2); color: #7f1d1d; }

    .action-buttons {
      display: flex;
      gap: 0.5rem;
      flex-wrap: wrap;
    }

    .btn-action {
      padding: 0.5rem 0.9rem;
      border-radius: 8px;
      border: none;
      font-weight: 600;
      font-size: 0.85rem;
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .btn-view {
      background: var(--gradient-1);
      color: white;
    }

    .btn-view:hover {
      transform: scale(1.05);
      box-shadow: 0 8px 16px rgba(99, 102, 241, 0.3);
    }

    .btn-approve {
      background: var(--success);
      color: white;
    }

    .btn-approve:hover {
      background: #059669;
      transform: scale(1.05);
    }

    .btn-reject {
      background: var(--danger);
      color: white;
    }

    .btn-reject:hover {
      background: #dc2626;
      transform: scale(1.05);
    }

    /* === MODAL === */
    .modal-content {
      border: none;
      border-radius: 16px;
      box-shadow: var(--shadow-lg);
    }

    .modal-header {
      background: var(--gradient-1);
      color: white;
      border: none;
      border-radius: 16px 16px 0 0;
    }

    .modal-title {
      font-weight: 800;
      letter-spacing: -0.5px;
    }

    .modal-body {
      padding: 2rem;
    }

    .detail-row {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 1.5rem;
      margin-bottom: 1.5rem;
    }

    .detail-row.full {
      grid-template-columns: 1fr;
    }

    .detail-item h6 {
      font-weight: 800;
      color: var(--dark-text);
      font-size: 0.9rem;
      text-transform: uppercase;
      margin-bottom: 0.5rem;
      letter-spacing: 0.5px;
    }

    .detail-item p {
      color: #64748b;
      margin: 0;
      font-weight: 500;
    }

    /* === EMPTY STATE === */
    .empty-state {
      text-align: center;
      padding: 3rem 2rem;
      color: #94a3b8;
    }

    .empty-state-icon {
      font-size: 3rem;
      margin-bottom: 1rem;
      opacity: 0.5;
    }

    /* === ACTIONS === */
    .action-buttons-modal {
      display: flex;
      gap: 1rem;
      margin-top: 2rem;
      padding-top: 2rem;
      border-top: 1px solid rgba(99, 102, 241, 0.1);
    }

    .btn-modal {
      padding: 0.9rem 1.8rem;
      border-radius: 10px;
      border: none;
      font-weight: 700;
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .btn-modal-primary {
      background: var(--gradient-1);
      color: white;
    }

    .btn-modal-primary:hover {
      transform: translateY(-2px);
      box-shadow: var(--shadow-lg);
    }

    .btn-modal-secondary {
      background: #f1f5f9;
      color: var(--dark-text);
      border: 2px solid var(--primary);
    }

    .btn-modal-secondary:hover {
      background: var(--primary);
      color: white;
    }

    /* === RESPONSIVE === */
    @media (max-width: 768px) {
      .detail-row {
        grid-template-columns: 1fr;
      }

      .action-buttons {
        flex-direction: column;
      }

      .btn-action {
        width: 100%;
      }

      .admin-title {
        font-size: 1.5rem;
      }
    }
  </style>
</head>
<body>

  <!-- === NAVBAR === -->
  <nav class="admin-header" style="position: sticky; top: 0; z-index: 1000; box-shadow: 0 4px 6px rgba(0,0,0,0.1);">
    <div class="container-fluid px-4">
      <div style="display: flex; justify-content: space-between; align-items: center; padding: 1rem 0;">
        <!-- Logo + Brand -->
        <div style="display: flex; align-items: center; gap: 1rem;">
          <img src="assets/images/Logo12.jpg" alt="Pet's Heaven Logo" style="height: 40px; width: auto; border-radius: 6px;">
          <span style="font-weight: 700; font-size: 1.1rem; color: var(--dark-text);">Pet's Heaven</span>
        </div>

        <!-- Navigation Menu -->
        <div style="display: flex; align-items: center; gap: 2rem;">
          <a href="index.html" style="text-decoration: none; color: #64748b; font-weight: 500; display: flex; align-items: center; gap: 0.5rem; transition: all 0.3s ease;">
            <i class="bi bi-house"></i>Accueil
          </a>
          <a href="index.html#vets" style="text-decoration: none; color: #64748b; font-weight: 500; display: flex; align-items: center; gap: 0.5rem; transition: all 0.3s ease;">
            <i class="bi bi-hospital"></i>Vétérinaires
          </a>
          <a href="index.html#partners" style="text-decoration: none; color: #64748b; font-weight: 500; display: flex; align-items: center; gap: 0.5rem; transition: all 0.3s ease;">
            <i class="bi bi-handshake"></i>Devenir Partenaire
          </a>
        </div>

        <!-- Buttons -->
        <div style="display: flex; align-items: center; gap: 1rem;">
          <button onclick="exportData()" class="btn btn-primary" style="background: var(--gradient-1); border: none; font-weight: 700; padding: 0.6rem 1.5rem; border-radius: 10px;">
            <i class="bi bi-file-earmark-check me-2"></i>GESTION DES CANDIDATURES
          </button>
          <a href="vet-dashboard.html" class="btn btn-outline-primary" style="border: 2px solid var(--primary); color: var(--primary); font-weight: 700; padding: 0.6rem 1.2rem; border-radius: 10px; text-decoration: none;">
            <i class="bi bi-arrow-left me-2"></i>RETOUR
          </a>
        </div>
      </div>
    </div>
  </nav>

  <!-- === MAIN CONTENT === -->
  <div class="container-fluid px-4" style="padding: 2rem 0;">
    
    <!-- === HERO SECTION === -->
    <div style="background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 50%, #ec4899 100%); border-radius: 16px; padding: 3rem 2rem; margin-bottom: 2rem; color: white; text-align: center;">
      <h1 style="font-size: 2.5rem; font-weight: 900; margin-bottom: 1rem;">Devenez Partenaire de Pet's Heaven</h1>
      <p style="font-size: 1.1rem; opacity: 0.95; margin-bottom: 2rem; max-width: 700px; margin-left: auto; margin-right: auto;">Rejoignez le réseau Pet's Heaven et développez votre activité sans frais d'enregistrement</p>
      
      <!-- Stats Row -->
      <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 2rem; margin-top: 2rem;">
        <div>
          <div style="font-size: 2.5rem; font-weight: 900; margin-bottom: 0.5rem;">0 DH</div>
          <div style="font-size: 0.95rem; opacity: 0.9;">Frais d'inscription</div>
        </div>
        <div>
          <div style="font-size: 2.5rem; font-weight: 900; margin-bottom: 0.5rem;">32+</div>
          <div style="font-size: 0.95rem; opacity: 0.9;">Vétérinaires actifs</div>
        </div>
        <div>
          <div style="font-size: 2.5rem; font-weight: 900; margin-bottom: 0.5rem;">150+</div>
          <div style="font-size: 0.95rem; opacity: 0.9;">Patients actifs</div>
        </div>
      </div>
    </div>
    
    <!-- === STATISTICS === -->
    <div class="stats-grid">
      <div class="stat-box pending">
        <div class="stat-number" id="statPending">0</div>
        <div class="stat-label">En Attente</div>
      </div>
      <div class="stat-box interview">
        <div class="stat-number" id="statInterview">0</div>
        <div class="stat-label">Entretien</div>
      </div>
      <div class="stat-box approved">
        <div class="stat-number" id="statApproved">0</div>
        <div class="stat-label">Approuvés</div>
      </div>
      <div class="stat-box rejected">
        <div class="stat-number" id="statRejected">0</div>
        <div class="stat-label">Rejetés</div>
      </div>
    </div>

    <!-- === CANDIDATES TABLE === -->
    <div class="candidates-container">
      <h2 class="section-title">
        <i class="bi bi-list-check"></i>Toutes les Candidatures
      </h2>

      <div class="candidates-table">
        <table id="candidatesTable">
          <thead>
            <tr>
              <th>ID</th>
              <th>Nom & Prénom</th>
              <th>Clinique</th>
              <th>Spécialité</th>
              <th>Ville</th>
              <th>Statut</th>
              <th>Date</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody id="candidatesBody">
            <tr>
              <td colspan="8" style="text-align: center; padding: 2rem; color: #94a3b8;">
                <div class="empty-state-icon">
                  <i class="bi bi-inbox"></i>
                </div>
                <p>Aucune candidature pour le moment</p>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>

  </div>

  <!-- === MODAL DÉTAILS === -->
  <div class="modal fade" id="detailsModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-lg modal-dialog-centered">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">Détails de la Candidature</h5>
          <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body">
          <div id="detailsContent"></div>
          <div class="action-buttons-modal" id="actionButtons"></div>
        </div>
      </div>
    </div>
  </div>

  <!-- Bootstrap JS -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

  <script>
    let allCandidates = [];
    let currentCandidate = null;

    // Charger les données
    function loadCandidates() {
      allCandidates = JSON.parse(localStorage.getItem('ph_all_vet_registrations') || '[]');
      updateStatistics();
      renderTable();
    }

    // Mettre à jour les statistiques
    function updateStatistics() {
      const pending = allCandidates.filter(c => c.status === 'En attente de vérification').length;
      const interview = allCandidates.filter(c => c.status === 'Entretien planifié').length;
      const approved = allCandidates.filter(c => c.status === 'Approuvé').length;
      const rejected = allCandidates.filter(c => c.status === 'Rejeté').length;

      document.getElementById('statPending').textContent = pending;
      document.getElementById('statInterview').textContent = interview;
      document.getElementById('statApproved').textContent = approved;
      document.getElementById('statRejected').textContent = rejected;
    }

    // Rendre le tableau
    function renderTable() {
      const tbody = document.getElementById('candidatesBody');
      
      if (allCandidates.length === 0) {
        tbody.innerHTML = `
          <tr>
            <td colspan="8" style="text-align: center; padding: 2rem; color: #94a3b8;">
              <div class="empty-state-icon">
                <i class="bi bi-inbox"></i>
              </div>
              <p>Aucune candidature pour le moment</p>
            </td>
          </tr>
        `;
        return;
      }

      tbody.innerHTML = allCandidates.map(candidate => {
        const statusBadge = getStatusBadge(candidate.status);
        const date = new Date(candidate.registrationDate).toLocaleDateString('fr-FR');
        
        return `
          <tr>
            <td><strong>${candidate.id}</strong></td>
            <td><strong>${candidate.personalInfo.firstName} ${candidate.personalInfo.lastName}</strong></td>
            <td>${candidate.professionalInfo.clinicName}</td>
            <td>${candidate.professionalInfo.specialty}</td>
            <td>${candidate.location.city}</td>
            <td>${statusBadge}</td>
            <td>${date}</td>
            <td>
              <div class="action-buttons">
                <button class="btn-action btn-view" onclick="showDetails('${candidate.id}')">
                  <i class="bi bi-eye"></i> Voir
                </button>
              </div>
            </td>
          </tr>
        `;
      }).join('');
    }

    // Retourner le badge de statut
    function getStatusBadge(status) {
      const statusClass = status === 'En attente de vérification' ? 'pending' 
                        : status === 'Entretien planifié' ? 'interview'
                        : status === 'Approuvé' ? 'approved'
                        : 'rejected';
      
      return `<span class="badge-status badge-${statusClass}">${status}</span>`;
    }

    // Afficher les détails
    function showDetails(vetId) {
      currentCandidate = allCandidates.find(c => c.id === vetId);
      if (!currentCandidate) return;

      const html = `
        <div class="detail-row">
          <div class="detail-item">
            <h6>ID Candidature</h6>
            <p>${currentCandidate.id}</p>
          </div>
          <div class="detail-item">
            <h6>Statut</h6>
            <p>${getStatusBadge(currentCandidate.status)}</p>
          </div>
        </div>

        <div style="border-top: 2px solid rgba(99, 102, 241, 0.1); padding-top: 1.5rem; margin-top: 1.5rem;">
          <h5 style="font-weight: 800; margin-bottom: 1rem; color: var(--dark-text);">Informations Personnelles</h5>
          <div class="detail-row">
            <div class="detail-item">
              <h6>Prénom</h6>
              <p>${currentCandidate.personalInfo.firstName}</p>
            </div>
            <div class="detail-item">
              <h6>Nom</h6>
              <p>${currentCandidate.personalInfo.lastName}</p>
            </div>
            <div class="detail-item">
              <h6>Email</h6>
              <p>${currentCandidate.personalInfo.email}</p>
            </div>
            <div class="detail-item">
              <h6>Téléphone</h6>
              <p>${currentCandidate.personalInfo.phone}</p>
            </div>
          </div>
        </div>

        <div style="border-top: 2px solid rgba(99, 102, 241, 0.1); padding-top: 1.5rem; margin-top: 1.5rem;">
          <h5 style="font-weight: 800; margin-bottom: 1rem; color: var(--dark-text);">Informations Professionnelles</h5>
          <div class="detail-row">
            <div class="detail-item">
              <h6>Clinique</h6>
              <p>${currentCandidate.professionalInfo.clinicName}</p>
            </div>
            <div class="detail-item">
              <h6>Spécialité</h6>
              <p>${currentCandidate.professionalInfo.specialty}</p>
            </div>
            <div class="detail-item">
              <h6>Expérience</h6>
              <p>${currentCandidate.professionalInfo.experience} ans</p>
            </div>
          </div>
        </div>

        <div style="border-top: 2px solid rgba(99, 102, 241, 0.1); padding-top: 1.5rem; margin-top: 1.5rem;">
          <h5 style="font-weight: 800; margin-bottom: 1rem; color: var(--dark-text);">Localisation</h5>
          <div class="detail-row full">
            <div class="detail-item">
              <h6>Adresse</h6>
              <p>${currentCandidate.location.address}</p>
            </div>
          </div>
          <div class="detail-row">
            <div class="detail-item">
              <h6>Ville</h6>
              <p>${currentCandidate.location.city}</p>
            </div>
            <div class="detail-item">
              <h6>Code Postal</h6>
              <p>${currentCandidate.location.codePostal}</p>
            </div>
          </div>
        </div>

        <div style="border-top: 2px solid rgba(99, 102, 241, 0.1); padding-top: 1.5rem; margin-top: 1.5rem;">
          <h5 style="font-weight: 800; margin-bottom: 1rem; color: var(--dark-text);">Disponibilités</h5>
          <div class="detail-row">
            <div class="detail-item">
              <h6>Heure d'ouverture</h6>
              <p>${currentCandidate.availability.openingTime}</p>
            </div>
            <div class="detail-item">
              <h6>Heure de fermeture</h6>
              <p>${currentCandidate.availability.closingTime}</p>
            </div>
          </div>
          <div class="detail-row full">
            <div class="detail-item">
              <h6>Jours d'ouverture</h6>
              <p>${currentCandidate.availability.days.join(', ')}</p>
            </div>
          </div>
        </div>
      `;

      document.getElementById('detailsContent').innerHTML = html;
      renderActionButtons();
      
      const modal = new bootstrap.Modal(document.getElementById('detailsModal'));
      modal.show();
    }

    // Rendre les boutons d'action
    function renderActionButtons() {
      const buttons = document.getElementById('actionButtons');
      const status = currentCandidate.status;

      let html = '';

      if (status === 'En attente de vérification') {
        html = `
          <button class="btn-modal btn-modal-primary" onclick="approveCandidate()">
            <i class="bi bi-check-circle me-2"></i>Approuver
          </button>
          <button class="btn-modal btn-modal-secondary" onclick="rejectCandidate()">
            <i class="bi bi-x-circle me-2"></i>Rejeter
          </button>
        `;
      } else if (status === 'Entretien planifié') {
        html = `
          <button class="btn-modal btn-modal-primary" onclick="approveCandidate()">
            <i class="bi bi-check-circle me-2"></i>Approuver
          </button>
          <button class="btn-modal btn-modal-secondary" onclick="rejectCandidate()">
            <i class="bi bi-x-circle me-2"></i>Rejeter
          </button>
        `;
      } else if (status === 'Approuvé') {
        html = `<p style="color: #10b981; font-weight: 700;"><i class="bi bi-check-circle me-2"></i>Candidature approuvée</p>`;
      } else {
        html = `<p style="color: #ef4444; font-weight: 700;"><i class="bi bi-x-circle me-2"></i>Candidature rejetée</p>`;
      }

      buttons.innerHTML = html;
    }

    // Approuver la candidature
    function approveCandidate() {
      if (!currentCandidate) return;

      currentCandidate.status = 'Approuvé';
      currentCandidate.approvalDate = new Date().toISOString();

      // Sauvegarder
      const index = allCandidates.findIndex(c => c.id === currentCandidate.id);
      if (index !== -1) {
        allCandidates[index] = currentCandidate;
        localStorage.setItem('ph_all_vet_registrations', JSON.stringify(allCandidates));
      }

      updateStatistics();
      renderTable();
      
      alert('✅ Candidature approuvée !');
      bootstrap.Modal.getInstance(document.getElementById('detailsModal')).hide();
    }

    // Rejeter la candidature
    function rejectCandidate() {
      const reason = prompt('Veuillez indiquer la raison du rejet:');
      if (!reason) return;

      if (!currentCandidate) return;

      currentCandidate.status = 'Rejeté';
      currentCandidate.rejectionReason = reason;
      currentCandidate.rejectionDate = new Date().toISOString();

      // Sauvegarder
      const index = allCandidates.findIndex(c => c.id === currentCandidate.id);
      if (index !== -1) {
        allCandidates[index] = currentCandidate;
        localStorage.setItem('ph_all_vet_registrations', JSON.stringify(allCandidates));
      }

      updateStatistics();
      renderTable();
      
      alert('❌ Candidature rejetée');
      bootstrap.Modal.getInstance(document.getElementById('detailsModal')).hide();
    }

    // Exporter les données
    function exportData() {
      if (allCandidates.length === 0) {
        alert('Aucune candidature à exporter');
        return;
      }

      const dataStr = JSON.stringify(allCandidates, null, 2);
      const dataBlob = new Blob([dataStr], { type: 'application/json' });
      const url = URL.createObjectURL(dataBlob);
      const link = document.createElement('a');
      link.href = url;
      link.download = `candidatures_${new Date().toISOString().split('T')[0]}.json`;
      link.click();
      URL.revokeObjectURL(url);
    }

    // Charger à l'initialisation
    document.addEventListener('DOMContentLoaded', loadCandidates);
  </script>

</body>
</html>
