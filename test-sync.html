<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Test Synchronisation - Pet's Heaven</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    body { padding: 20px; }
    .test-section { margin: 20px 0; padding: 20px; border: 2px solid #4f46e5; border-radius: 10px; }
    .success { color: green; font-weight: bold; }
    .error { color: red; font-weight: bold; }
    .info { color: blue; }
    pre { background: #f3f4f6; padding: 10px; border-radius: 5px; overflow-x: auto; }
  </style>
</head>
<body>
  <div class="container">
    <h1>üîç Test Synchronisation V√©t√©rinaires</h1>
    
    <div class="test-section">
      <h3>1Ô∏è‚É£ V√©t√©rinaires Inscrits (ph_vet_profiles)</h3>
      <div id="vetProfiles"></div>
    </div>

    <div class="test-section">
      <h3>2Ô∏è‚É£ Liste Vets Clients (ph_vet_list)</h3>
      <div id="vetList"></div>
    </div>

    <div class="test-section">
      <h3>3Ô∏è‚É£ V√©t√©rinaires dans rdv.js</h3>
      <div id="rdjVets"></div>
    </div>

    <div class="test-section">
      <h3>4Ô∏è‚É£ Rendez-vous Synchronis√©s (ph_appointments)</h3>
      <div id="appointments"></div>
    </div>

    <div class="test-section">
      <h3>5Ô∏è‚É£ Action: Cr√©er un Test V√©t√©rinaire</h3>
      <button class="btn btn-primary" onclick="createTestVet()">Cr√©er Dr. Test</button>
      <div id="actionResult" style="margin-top: 10px;"></div>
    </div>

    <div class="test-section">
      <h3>6Ô∏è‚É£ Synchronisation Status</h3>
      <button class="btn btn-success" onclick="checkSync()">V√©rifier Sync</button>
      <div id="syncStatus" style="margin-top: 10px;"></div>
    </div>
  </div>

  <script>
    function displayData(elementId, data, title = "") {
      const elem = document.getElementById(elementId);
      if (!data || data.length === 0) {
        elem.innerHTML = `<p class="error">‚ùå ${title} - Aucune donn√©e</p>`;
      } else {
        elem.innerHTML = `<p class="success">‚úÖ ${title} - ${data.length} item(s)</p>
          <pre>${JSON.stringify(data, null, 2)}</pre>`;
      }
    }

    function checkAllData() {
      const vetProfiles = JSON.parse(localStorage.getItem('ph_vet_profiles') || '[]');
      const vetList = JSON.parse(localStorage.getItem('ph_vet_list') || '[]');
      const appointments = JSON.parse(localStorage.getItem('ph_appointments') || '[]');

      displayData('vetProfiles', vetProfiles, 'Profils V√©t√©rinaires');
      displayData('vetList', vetList, 'Liste Clients');
      displayData('appointments', appointments, 'Rendez-vous');

      // Afficher les vets de rdv.js
      const rdjVetsDiv = document.getElementById('rdjVets');
      rdjVetsDiv.innerHTML = `<p class="info">üìã Vets dans rdv.js seront charg√©s quand rdv.html se charge</p>
        <p>Pour voir les vets, visitez <a href="rdv.html">rdv.html</a></p>`;
    }

    function createTestVet() {
      const testVet = {
        id: Date.now().toString(),
        name: "Dr. Test Sync",
        email: "test@sync.com",
        password: btoa("password123"),
        specialty: "Test Sp√©cialit√©",
        phone: "+212 6 00 00 00 00",
        city: "Test City",
        license: "TEST-2024-001",
        createdAt: new Date().toISOString(),
        appointments: []
      };

      const profiles = JSON.parse(localStorage.getItem('ph_vet_profiles') || '[]');
      profiles.push(testVet);
      localStorage.setItem('ph_vet_profiles', JSON.stringify(profiles));

      // Sync to vet list
      const vetList = JSON.parse(localStorage.getItem('ph_vet_list') || '[]');
      const existingVet = vetList.find(v => v.email === testVet.email);
      if (!existingVet) {
        vetList.push({
          id: testVet.id,
          name: testVet.name,
          email: testVet.email,
          city: testVet.city,
          specialty: testVet.specialty,
          phone: testVet.phone,
          rating: 5.0,
          reviews: 0,
          isRegistered: true,
          registeredAt: testVet.createdAt
        });
        localStorage.setItem('ph_vet_list', JSON.stringify(vetList));
      }

      document.getElementById('actionResult').innerHTML = 
        `<p class="success">‚úÖ V√©t√©rinaire test cr√©√©!</p>
         <p>V√©rifiez maintenant vets.html et rdv.html pour voir si "Dr. Test Sync" appara√Æt</p>`;
      
      checkAllData();
    }

    function checkSync() {
      const profiles = JSON.parse(localStorage.getItem('ph_vet_profiles') || '[]');
      const vetList = JSON.parse(localStorage.getItem('ph_vet_list') || '[]');
      const appointments = JSON.parse(localStorage.getItem('ph_appointments') || '[]');

      let syncOk = true;
      let issues = [];

      if (profiles.length === 0) {
        issues.push("‚ùå Aucun profil v√©t√©rinaire");
      } else {
        issues.push(`‚úÖ ${profiles.length} profil(s) v√©t√©rinaire(s)`);
      }

      if (vetList.length === 0) {
        issues.push("‚ùå Liste vets clients vide");
        syncOk = false;
      } else {
        issues.push(`‚úÖ ${vetList.length} vets dans liste clients`);
      }

      if (profiles.length > 0 && vetList.length === 0) {
        issues.push("‚ö†Ô∏è Profils non synchronis√©s avec liste clients");
        syncOk = false;
      }

      if (appointments.length > 0) {
        issues.push(`‚úÖ ${appointments.length} rendez-vous`);
      } else {
        issues.push("‚ÑπÔ∏è Aucun rendez-vous (normal si pas encore pris)");
      }

      const syncDiv = document.getElementById('syncStatus');
      syncDiv.innerHTML = `
        <div class="${syncOk ? 'success' : 'error'}">
          ${syncOk ? '‚úÖ SYNCHRONISATION OK' : '‚ùå PROBL√àME DE SYNCHRONISATION'}
        </div>
        <ul style="margin-top: 10px;">
          ${issues.map(issue => `<li>${issue}</li>`).join('')}
        </ul>
      `;
    }

    // Afficher les donn√©es au chargement
    window.addEventListener('load', checkAllData);
  </script>
</body>
</html>
